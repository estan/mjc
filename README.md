MiniJava Compiler (`mjc`)
=========================

This is a compiler for a slightly modified version of the MiniJava
language described in Appel's *Modern Compiler Implementation in Java*.
It was created as part of the course *DD2488 Compiler Construction* at
KTH.

Building
--------

Type `ant` in the top-level directory. This will build the compiler
and unit tests, and produce `mjc.jar`. See `ant -projecthelp` for the
different available targets. Here's a hopefully up to date list:

    Main targets:
     clean    Delete all generated files
     compile  Compile all sources
     jar      Build compiler JAR file
     tar      Build compressed source-only TAR archive
     test     Run the unit tests
    Default target: jar

Running
-------
To run the compiler, type

    java -cp mjc.jar:lib/* mjc.ARMMain foo.java -S

where `foo.java` is the MiniJava source file to be compiled, or use the
`bin/mjc` script. The availble command line options are:

    usage: java ARMMain <file> <options>
     -g         print abstract syntax tree (GraphViz)
     -h         show help message
     -o <arg>   output file
     -p         print abstract syntax tree
     -S         output assembler code

Hacking in Eclipse
------------------

To get started in Eclipse, make an initial build with Ant by typing `ant`,
then perform the following steps in a new or existing Eclipse workspace:

1. **File → New → Java Project**.
2. Enter **mjc** as Project name.
3. Uncheck **Use default location** and pick the **mjc** folder as **Location**.
4. Click **Next** and then **Finish**.

It's important that the **Output folder** for each source folder matches
the Ant configuration. To accomplish this:

1. In the project properties for the **mjc** project, under
   **Java Build Path → Source**:
  1. Check the **Allow output folders for source folders** checkbox.
  2. Change the **Output folder** for each of the source folders to
    * **build/parser-classes** for **mjc/build/parser-src**
    * **build/main-classes** for **mjc/src/main/java**, and
    * **build/test-classes** for **mjc/src/test/java**.
  3. Click **OK**.

The sources in **build/parser-src** generated by SableCC have some warnings.
To silence them, in the properties for the **build/parser-src** source folder,
under **Java Compiler** check the checkbox **Ignore optional compile problems**.

**That's it!**

Submitting to TIGRIS
--------------------

To create a compressed source-only TAR archive for submission to TIGRIS, type

    ant tar -Dtigris.id=ID -Dtigris.email=EMAIL

Where `ID` and `EMAIL` are the TIGRIS ID and e-mail address you want to use.
The Ant target will automatically put these into the `DESC` file before
assembling all source files into the output file `mjc.tar.gz`.
